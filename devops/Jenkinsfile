pipeline {
  agent any
  triggers {
    pollSCM '*/5 * * * *'
  }

  stages {
    stage ("Tomcat"){
      steps {
        sh '''
          echo "Hello World! Installing tomcat on remote machine using ansible playbook."
          pwd
          ls -al
          whoami
        '''
        ansiblePlaybook(
          playbook: 'devops/maven-ansible-playbook.yaml', 
          credentialsId: 'tinakaa',
          disableHostKeyChecking: true,
        )
      }
    }
    stage ("Compile"){
      steps {
       sh '''
        echo "stage Compile, to Compile src code from Jenkins workspace"
        pwd
        whoami
        mvn clean compile
       '''
      }
    }
    stage ("Package"){
      steps {
       sh '''
        echo "stage package, to pacakge src code form Jenkins workspace. and get the war file on Jenkins workstation"
        mvn package
       '''
      }
    }
    stage ("Deploy"){
      steps {
       sh '''
        echo "stage Deploy, to Deploy war file from jenkins workspace to tomcat machine"
        deploy adapters: [tomcat8(credentialsId: 'tomcat', path: '', url: 'http://192.168.127.130:8080')], contextPath: 'jenkins', war: '**/*.war'
       '''
      }
    }
  }
}
